# Brief: CompilerStatus Island Component

## Execution Record

> **Instructions for AI:** Before this brief is moved to `briefs/done/`, fill in this section completely. Be specific and honest — this is the project's permanent record of what happened.

**Date completed:** 2026-02-18
**Status:** Complete. Island component live on the homepage with all three tabs functional.

### What was done

- Created `sites/urd.dev/src/pages/compiler.json.ts` — JSON endpoint that reads the test report from `src/data/compiler-test-report.json` using `process.cwd()` for reliable path resolution during Astro's static build.
- Created `sites/urd.dev/src/components/CompilerStatus.svelte` — ~900-line Svelte 5 island with three tabs (Phases, Compliance, Benchmarks), summary stats row, expandable phase cards with category/test-level drill-down, compliance checklist, and per-file benchmark cards with phase timing bars.
- Added the island to `sites/urd.dev/src/pages/index.astro` with `client:visible` hydration, positioned between the Timeline and Updates sections.
- Followed all Gloaming design tokens: `--raise` card backgrounds, `--green` pass indicators, `--gold-dim` section label, `--mono`/`--display`/`--body` fonts, text-only icons (✓ ✗ ▸ ▾).
- Phase cards made compact and interactive: entire top area is a `<button>`, inline pass count (`42/42`), chevron indicator, hover highlight.
- Responsive at 980px and 640px breakpoints.
- Empty state message when no report is available.

### What changed from the brief

- **Placement.** Brief specified between Architecture and Reviews. User requested it above Updates instead. Final order: Timeline → Compiler Status → Updates → Documents → Architecture → Reviews.
- **Section label colour.** Brief specified `--amber-dim`. Changed to `--gold-dim` to match all other section labels on the homepage.
- **Phase count display.** Brief used dynamic `phaseCount` from the phases array. Changed to hardcoded "5 phases" since e2e is end-to-end integration testing, not a compiler phase.
- **Path resolution in endpoint.** Tried `import.meta.dirname` and `fileURLToPath(import.meta.url)` before settling on `process.cwd()` which works reliably because pnpm filters to the urd.dev workspace during build.

---

**Created:** 2026-02-18

## Objective

Build a `CompilerStatus` Svelte 5 island that displays the compiler test report on the urd.dev homepage. The component should be information-dense, technically precise, and confidence-instilling — an engineer visiting the site should immediately see that the compiler is real, tested, and working.

## Data source

The compiler test report is generated by `pnpm compiler:test` and written to `packages/compiler/test-report.json`. A copy step places it at `sites/urd.dev/src/data/compiler-test-report.json` for the Astro site to consume. The report schema is defined in `scripts/compiler-test-report.schema.json`.

### JSON endpoint

Create `src/pages/compiler.json.ts` that reads the data file and returns it. If the file doesn't exist (e.g. dev environment without Rust), return `null`. This follows the same endpoint pattern as `documents.json.ts`, `reviews.json.ts`, etc.

## Component Design

### Placement

Add the island to `index.astro` **between the Architecture section and the Reviews section**. Narrative flow: architecture explains the design → compiler status proves it works → reviews validate externally.

Use `client:visible` hydration and the standard section separator (`48px padding-top`, `1px border-top`).

### Layout

```
┌─ HEADER ────────────────────────────────────────────┐
│ Label: COMPILER · VALIDATION (amber/green accents)  │
│ Title: Test Suite                                    │
│ Subtitle: N tests across M phases · <timestamp>     │
└─────────────────────────────────────────────────────┘

┌─ STATS ROW (4 metric cards) ────────────────────────┐
│ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌─────────┐ │
│ │ Pass Rate│ │ Tests    │ │ Duration │ │ Version │ │
│ │ 100.0%   │ │ 302      │ │ 1.2s     │ │ 0.1.0   │ │
│ └──────────┘ └──────────┘ └──────────┘ └─────────┘ │
└─────────────────────────────────────────────────────┘

┌─ TABS ──────────────────────────────────────────────┐
│ [Phases]  [Compliance]  [Benchmarks]                │
└─────────────────────────────────────────────────────┘

┌─ PHASES TAB (default) ──────────────────────────────┐
│ 2-column grid of phase cards, each expandable:      │
│ ┌─ PARSE ──────────┐ ┌─ IMPORT ─────────┐          │
│ │ 42/42 passed     │ │ 18/18 passed     │          │
│ │ ████████████ bar │ │ ████████████ bar │          │
│ │ diag: 100-199    │ │ diag: 200-299    │          │
│ │ ▸ 5 categories   │ │ ▸ 3 categories   │          │
│ └──────────────────┘ └──────────────────┘          │
│ (+ LINK, VALIDATE, EMIT, E2E, SCAFFOLDING)         │
│                                                     │
│ Expanded card shows category breakdown:             │
│   frontmatter (14/14)                               │
│     frontmatter_basic ✓                             │
│     frontmatter_types ✓                             │
└─────────────────────────────────────────────────────┘

┌─ COMPLIANCE TAB ────────────────────────────────────┐
│ 2-column checklist:                                 │
│ ✓ Deterministic output — Fixed key order, topo sort │
│ ✓ Error recovery — Mark & continue, no cascading    │
│ ✓ Phase contracts — Input/output types enforced     │
│ ✓ Diagnostic ownership — Each phase owns code range │
│ ✓ ID derivation — Slugify, file_stem/name           │
│ ✓ Annotation model — Option<String> IDs via symtab  │
└─────────────────────────────────────────────────────┘

┌─ BENCHMARKS TAB ────────────────────────────────────┐
│ Aggregate stats: N files · Xms avg · Y bytes/ms     │
│ Per-file cards with phase timing breakdown           │
│ (or "No benchmark data available" if empty)          │
└─────────────────────────────────────────────────────┘
```

### Design tokens

| Element | Token | Notes |
|---------|-------|-------|
| Phase card accent | `--amber` (2-3px left border) | Compiler/architecture category |
| Pass indicators | `--green` | Validation/testing category |
| Fail indicators | `--rose` | Error states |
| Skip indicators | `--text-faint` | Neutral |
| Card background | `var(--raise)` | Standard card pattern |
| Card border | `1px solid var(--border)` | Standard |
| Stat numbers | `--mono` font, `--text` colour | Large, prominent |
| Stat labels | `--display` font, `--text-faint` | Small, uppercase |
| Section label | 12px uppercase `--display`, `--amber-dim` | Matches other sections |
| Progress bars | `--green` fill, `var(--deep)` track | Thin, full-width |
| Tab buttons | `--display` font, border style | Matches filter button pattern from DocumentExplorer |
| Diagnostic badges | `--mono` font, `--border` background | Pill-shaped |
| Text characters | ✓ ▸ → ◆ | No icon libraries |

### Typography

- Section label: 12px Outfit, uppercase, letter-spacing 0.08em
- Section title: clamp(22px, 3.5vw, 28px) Outfit, weight 700
- Stat values: 28-32px JetBrains Mono, weight 600
- Stat labels: 11-12px Outfit, uppercase
- Phase names: 15-16px Outfit, weight 600, uppercase
- Test names: 13px JetBrains Mono
- Body text: 15px Source Serif 4

### Responsive behaviour

| Breakpoint | Stats row | Phase grid | Compliance |
|------------|-----------|------------|------------|
| > 980px | 4 columns | 2 columns | 2 columns |
| 640–980px | 2 columns | 1 column | 1 column |
| < 640px | 2 columns | 1 column | 1 column |

### Svelte 5 patterns

- `$state` for: `activeTab`, `expandedPhases` (Set), `loading`, `report`
- `$derived` for: formatted timestamp, duration display, phase count
- `onMount` → fetch `/compiler.json`
- Animations: `fadeUp` on section mount, `fadeIn` on card expand
- Respect `prefers-reduced-motion`
- `aria-expanded` on expandable cards, `role="tablist"` / `role="tab"` / `role="tabpanel"` for tabs

### Empty state

If the JSON endpoint returns `null` (no report available), show a minimal message: "No test report available. Run `pnpm compiler:test` to generate one." in mono font, faint colour.

## Files to create / modify

| File | Action |
|------|--------|
| `sites/urd.dev/src/pages/compiler.json.ts` | **Create** — JSON endpoint |
| `sites/urd.dev/src/components/CompilerStatus.svelte` | **Create** — island component |
| `sites/urd.dev/src/pages/index.astro` | **Modify** — add section between Architecture and Reviews |

## Out of scope

- No changes to the design system or global CSS (all styles scoped)
- No new npm dependencies
- No changes to existing components
- No content collections — this reads from a generated JSON file
- No modifications to the test report script or schema
