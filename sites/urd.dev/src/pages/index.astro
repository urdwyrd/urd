---
import Base from "../layouts/base.astro";
import Nav from "../components/Nav.astro";
import urdLogoDark from "../assets/logos/urd-logo-dark.svg?raw";
import urdLogoLight from "../assets/logos/urd-logo-light.svg?raw";
import wyrdLogoDark from "../assets/logos/wyrd-logo-dark.svg?raw";
import wyrdLogoLight from "../assets/logos/wyrd-logo-light.svg?raw";
import DocumentExplorer from "../components/DocumentExplorer.svelte";
import PeerReview from "../components/PeerReview.svelte";
import ProjectLog from "../components/ProjectLog.svelte";
import Architecture from "../components/Architecture.astro";
import CompilerStatus from "../components/CompilerStatus.svelte";
import ProjectTimeline from "../components/ProjectTimeline.svelte";
import RuneCanvas from "../components/RuneCanvas.astro";
import Presentation from "../components/Presentation.svelte";
---

<Base title="Urd · Define Worlds">
  <Nav />
  <RuneCanvas />

  <div class="hero-wrapper">
    <main class="hero">
      <div class="hero-content">
        <h1 class="wordmark">
          <span class="wordmark-half">
            <span class="logo logo-dark" aria-hidden="true" set:html={urdLogoDark} />
            <span class="logo logo-light" aria-hidden="true" set:html={urdLogoLight} />
            <span class="wordmark-urd">URD</span>
          </span>

          <span class="wordmark-half">
            <span class="logo logo-dark" aria-hidden="true" set:html={wyrdLogoDark} />
            <span class="logo logo-light" aria-hidden="true" set:html={wyrdLogoLight} />
            <span class="wordmark-wyrd">WYRD</span>
          </span>
        </h1>

        <p class="tagline">Define in Urd. Inspect. Run Anywhere.</p>

        <p class="description">
          A declarative schema system for interactive worlds - author in Schema Markdown, compile to JSON and a queryable model, run anywhere.
        </p>

        <div class="hero-actions">
          <button
            class="hero-cta"
            id="presentation-trigger"
            aria-expanded="false"
            aria-controls="presentation-container"
            onclick="window.dispatchEvent(new CustomEvent('urd:open-presentation'))"
          >
            A Quiet Introduction <span aria-hidden="true">▸</span>
          </button>
          <a
            href="/documents/urd-v0.1.14-reference"
            class="github-link"
          >
            v0.1.14 Reference Manual <span aria-hidden="true">→</span>
          </a>
        </div>

        <div class="hero-actions-secondary">
          <button
            class="video-cta"
            id="video-trigger"
            aria-label="Watch the video introduction"
          >
            Video Introduction <span aria-hidden="true">▸</span>
          </button>
        </div>
      </div>
    </main>
  </div>

  <Presentation client:idle />

  <div class="content">
    <section id="timeline">
      <ProjectTimeline client:visible />
    </section>

    <section id="compiler-status">
      <CompilerStatus client:visible />
    </section>

    <section id="updates">
      <ProjectLog client:visible />
    </section>

    <section id="documents">
      <DocumentExplorer client:visible />
    </section>

    <section id="architecture">
      <Architecture />
    </section>

    <section id="reviews">
      <PeerReview client:visible />
    </section>
  </div>
</Base>

<style>
  .hero-wrapper {
    position: relative;
    z-index: 1;
  }

  :global(html[data-presentation="open"]) .hero-wrapper {
    display: none;
  }

  .hero {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 4rem 2rem;
    text-align: center;
  }

  .hero-content {
    max-width: 640px;
    animation: fadeUp 0.6s ease-out both;
  }

  .wordmark {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: clamp(1.5rem, 4vw, 3rem);
    font-family: var(--wordmark);
    font-size: clamp(1rem, 2.5vw, 1.4rem);
    font-weight: 400;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    line-height: 1.1;
    margin-bottom: 1.5rem;
  }

  .wordmark-half {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.75rem;
  }

  .logo {
    width: clamp(80px, 16vw, 160px);
    height: clamp(80px, 16vw, 160px);
    opacity: 0.85;
  }

  .logo-light {
    display: none;
  }

  :global([data-theme="parchment"]) .logo-dark {
    display: none;
  }

  :global([data-theme="parchment"]) .logo-light {
    display: block;
  }

  .logo :global(svg) {
    width: 100%;
    height: 100%;
  }

  .wordmark-urd {
    background: linear-gradient(135deg, var(--gold-light), var(--gold));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .wordmark-wyrd {
    background: linear-gradient(135deg, var(--purple-light), var(--purple));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .tagline {
    font-family: var(--display);
    font-size: clamp(1.1rem, 3vw, 1.4rem);
    font-weight: 300;
    color: var(--dim);
    margin-bottom: 1.25rem;
    letter-spacing: 0.01em;
  }

  .description {
    font-family: var(--body);
    font-size: clamp(1rem, 2.5vw, 1.15rem);
    color: var(--faint);
    line-height: 1.7;
    margin-bottom: 2rem;
  }

  .hero-actions {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    flex-wrap: wrap;
  }

  .hero-cta {
    display: inline-block;
    font-family: var(--display);
    font-size: 0.95rem;
    font-weight: 500;
    color: var(--gold);
    background: transparent;
    padding: 0.6em 1.4em;
    border: 1px solid var(--gold-dark);
    border-radius: 6px;
    cursor: pointer;
    transition: border-color 0.2s ease, color 0.2s ease, background 0.2s ease;
  }

  .hero-cta:hover {
    border-color: var(--gold-dim);
    color: var(--gold-light);
    background: color-mix(in srgb, var(--gold) 4%, transparent);
  }

  .hero-cta:focus-visible {
    outline: 2px solid var(--gold);
    outline-offset: 2px;
  }

  @keyframes hero-cta-pulse {
    0%, 100% { box-shadow: 0 0 0 0 transparent; }
    50% { box-shadow: 0 0 18px -4px color-mix(in srgb, var(--gold) 25%, transparent); }
  }

  .hero-cta {
    animation: hero-cta-pulse 3s ease-in-out infinite;
  }

  @media (prefers-reduced-motion: reduce) {
    .hero-cta { animation: none; }
  }

  .github-link {
    display: inline-block;
    font-family: var(--display);
    font-size: 0.95rem;
    font-weight: 500;
    color: var(--gold);
    text-decoration: none;
    padding: 0.6em 1.4em;
    border: 1px solid var(--border);
    border-radius: 6px;
    transition: border-color 0.2s ease, color 0.2s ease;
  }

  .github-link:hover {
    border-color: var(--gold-dim);
    color: var(--gold-light);
  }

  .github-link:focus-visible {
    outline: 2px solid var(--gold);
    outline-offset: 2px;
  }

  .hero-actions-secondary {
    display: flex;
    justify-content: center;
    margin-top: 10px;
  }

  .video-cta {
    font-family: var(--display);
    font-size: 0.85rem;
    font-weight: 400;
    color: var(--faint);
    background: transparent;
    padding: 0.4em 1em;
    border: 1px solid transparent;
    border-radius: 6px;
    cursor: pointer;
    transition: color 0.2s ease, border-color 0.2s ease;
  }

  .video-cta:hover {
    color: var(--gold-dim);
    border-color: var(--border);
  }

  .video-cta:focus-visible {
    outline: 2px solid var(--gold);
    outline-offset: 2px;
  }

  .content {
    position: relative;
    z-index: 1;
    max-width: 1160px;
    margin: 0 auto;
    padding: 0 32px 96px;
  }

  .content > section {
    padding: 48px 0;
    border-top: 1px solid var(--border);
  }

  :global(html[data-presentation="open"]) .content {
    display: none;
  }

  @media (max-width: 520px) {
    .content {
      padding-left: 18px;
      padding-right: 18px;
    }
  }
</style>

<script>
  const YOUTUBE_ID = '2NvQGkgp64g';

  document.getElementById('video-trigger')?.addEventListener('click', () => {
    const overlay = document.createElement('div');
    overlay.className = 'video-lightbox';

    const inner = document.createElement('div');
    inner.className = 'video-lightbox-inner';

    const iframe = document.createElement('iframe');
    iframe.src = `https://www.youtube-nocookie.com/embed/${YOUTUBE_ID}?autoplay=1&rel=0`;
    iframe.allow = 'autoplay; encrypted-media';
    iframe.allowFullscreen = true;
    iframe.title = 'Urd & Wyrd — Video Introduction';

    const closeBtn = document.createElement('button');
    closeBtn.className = 'video-lightbox-close';
    closeBtn.textContent = 'Close \u00D7';
    closeBtn.setAttribute('aria-label', 'Close video');

    inner.appendChild(iframe);
    inner.appendChild(closeBtn);
    overlay.appendChild(inner);
    document.body.appendChild(overlay);
    document.body.style.overflow = 'hidden';

    function close() {
      overlay.remove();
      document.body.style.overflow = '';
    }

    closeBtn.addEventListener('click', close);
    overlay.addEventListener('click', (e) => {
      if (e.target === overlay) close();
    });
    document.addEventListener('keydown', function handler(e) {
      if (e.key === 'Escape') {
        close();
        document.removeEventListener('keydown', handler);
      }
    });

    closeBtn.focus();
  });
</script>
